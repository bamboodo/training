
CURRDIR := $(shell pwd)
LINUX_MACHINE := $(shell uname -m)
TOOLCHAINDIR := ${TMPDIR}/sysroots/$(LINUX_MACHINE)-linux/usr/bin/$(TARGET_SYS)
SYSROOTS := ${TMPDIR}/sysroots/$(MACHINE)/
SYSROOTSINC := $(SYSROOTS)/usr/include
SYSROOTSLIB := $(SYSROOTS)/usr/lib
CONFIGFILE := $(SYSROOTSINC)/.config

-include $(CONFIGFILE)
-include $(SYSROOTSINC)/autoconf.h

CC := $(TOOLCHAINDIR)/$(TARGET_CC)
AR := $(TOOLCHAINDIR)/$(TARGET_AR)

INC :=

CFLAGS := -fdata-sections -ffunction-sections -std=gnu99 -fno-strict-aliasing -fPIC \
			-DLINUX -pipe -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE=1 -D__LINUX__

ifeq ($(CONFIG_DEBUG),y)
CFLAGS += -fstack-protector-all
CFLAGS += -O0 -g
CFLAGS += -Wall -W -Wno-unused-value -Wno-pointer-sign
CFLAGS += -DCONFIG_DEBUG
endif

LIBLIST-y :=
LIBLIST-y += -ldl -lz -lstdc++

LDFLAGS := -Wl,--gc-sections   

obj-y :=
include main/Makefile

install: BUILD_DATE 


example: ${obj-y}
	@$(CC) $(LDFLAGS) -Wl,--start-group $(LIBLIST-y) ${obj-y} -Wl,--end-group  -o $@

clean:
	@find ./ -name *.o -exec rm {} \;
	@find ./ -name *.a -exec rm {} \;

distclean: clean

BUILD_DATE: FORCE
	@echo "//This code is generated by Makefile. Please do not change here!!" > main/build_date.c
	@echo "const char *g_strAppBuildDate = \"`date`\";" >> main/build_date.c
	@echo "const char *g_strAppBuildUser = \"`whoami`@`hostname`\";" >> main/build_date.c	

FORCE:

%.o: %.c
	$(CC) -c $< $(CFLAGS) $(INC) $(LDFLAGS) -o $@

.PHONY: example

vpath %.c main/
